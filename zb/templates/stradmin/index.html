{% extends 'admin/master.html' %}

{% block head_css %}
{{ super() }}
<link href="{{ admin_static.url(filename='vendor/bootstrap-daterangepicker/daterangepicker-bs3.css', v='3.x') }}" rel="stylesheet">
{% endblock %}

{% block body %}
{{ super() }}
<div class="container">
    <div class="row">
        {% if not current_user.is_authenticated %}
            <div class="col-sm-10 col-sm-offset-1">
                <h1>CK 管理后台</h1>
                <p class="lead">
                    Authentication
                </p>
                <p>You can register as a regular user, or log in as a superuser
                <p>
                    <a class="btn btn-primary" href="{{ url_for('security.login') }}">login</a> <a class="btn btn-default" href="{{ url_for('security.register') }}">register</a>
                </p>
            </div>
        {% else %}
            <div class="col-lg-3 col-xs-6">
                <small>
                    <li>DB中共有 {{ g_stat['total'] }} 个CK &nbsp; DB中可使用 {{ g_stat['could_use'] }} 个CK</li>
                    <li>缓存中未用 {{ g_stat['unused'] }} 个CK </li>
                    <li>总计可使用 {{ g_stat['unused'] + g_stat['could_use'] }} 个CK </li>
                    </br>
                    <li>启动时间：{{ g_stat['boot_ts'] }} </li>
                </small>
            </div>

            <div class="col-md-4">
                <form action="/admin/download" enctype='multipart/form-data' method='POST'>
                    <div class="row">
                        <div class="col-md-3">
                            <input class="btn btn-primary btn-sm" type="submit" value="下载CK">
                        </div>
                        <div class="input-group input-group-sm mb-3">
                            <input  id="reportrange" class="form-control" type="text" name="date_range" size="25" />
                        </div>
                    </div>
                </form>
                <br>
                <form class="form-inline" action="/admin/download" enctype='multipart/form-data' method='POST'>
                    <div class="row">
                        <div class="col-md-3">
                            <button type="submit" class="btn btn-primary btn-sm">下载CK</button>
                        </div>
                        <div class="input-group input-group-sm mb-3">
                            <input type="text" class="form-control" placeholder="ID Index Begin" value="0" name="ck_from" size="5" />
                        </div>
                        <div class="input-group input-group-sm mb-3">
                            <input type="text" class="form-control" placeholder="Num" value="1000" name="ck_to" size="5" />
                        </div>

                    </div>
                </form>
            </div>

            <div class="col-lg-5 col-xs-6">
                <form action="/admin/upload" enctype='multipart/form-data' method='POST'>
                        <div class="row">
                            <div class="col-lg-2 col-xs-2">
                                <input class="btn btn-primary btn-sm" type="submit" value="上传CK">
                            </div>
                            <div class="custom-file">
                                <small>
                                    <input type="file" class="custom-file-input form-control-sm" name="file" size="5">
                                </small>
                            </div>
                        </div>
                </form>
            </div>
        {% endif %}
    </div>
</div>

{% block tail %}
    <script src="{{ admin_static.url(filename='vendor/bootstrap-daterangepicker/daterangepicker.js', v='1.3.22') }}" type="text/javascript"></script>
    <script type="text/javascript">
        $(function() {
            var start = moment().subtract(29, 'days');
            var end = moment();

            function cb(start, end) {
                var psel = document.getElementById("reportrange");
                psel.value=start.format('MM/DD/YYYY') + ' - ' + end.format('MM/DD/YYYY')
            }

            $('#reportrange').daterangepicker({
                startDate: start,
                endDate: end,
                ranges: {
                   'Today': [moment(), moment()],
                   'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                   'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                   'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                   'This Month': [moment().startOf('month'), moment().endOf('month')],
                   'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                }
            }, cb);
            cb(start, end);
        });
    </script>
{% endblock %}

{% endblock body %}
